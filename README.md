# TCL Scripting WorkShop from Fundamentals to Advanced Techniques
Tool Command Language (Tcl) is a simple and flexible scripting language widely used in EDA, software development, and system administration. It enables automation, command execution, and data manipulation through easy-to-write scripts.
## Day1: Introduction and VSDSYNTH Toolbox Usage
### Task1: Create command of vsdsynth and pass the csv file from UNIX shell to TCL script
1. A custom command (sandy) was created to pass a CSV file from the UNIX shell to the Tcl script, following an algorithm that first informs the system it's a UNIX script.
``` bash 
 #!/bin/tcsh -f  
 ```
2. Created the logo
![pic4](https://github.com/user-attachments/assets/4dd7bf58-10c8-4bee-8090-062191ff3b47)
3. verifying three general scenarios for a user POV
   - User Not provided the .csv file as input:
If user type only ./sandysynth without any csv file, then this line of the code will work saying provide the csv file.
![pic6](https://github.com/user-attachments/assets/f0dc111d-ff44-4223-a62a-a5c53525666f)
![image](https://github.com/user-attachments/assets/afa54068-1669-4ac4-81e7-a65e131f94ae)
 - Users provide a .csv file which doesn’t exist:
If user have provided the csv file with ./sandysynth my.csv then first it will check for the argument if it is true, then go to next line and then again check whether the argument 1 is not equal to -help then the error will print by telling the user that cannot find the csv file my.csv
![pic7](https://github.com/user-attachments/assets/46f69159-7fd3-463c-b7d1-4dc90b4f644a)
![image](https://github.com/user-attachments/assets/b8bbeb68-8dd3-4f77-9d62-fded5642bdf1)
- Type “-help” to find out usage:
If we user wants to find out the usage, then type ./sandysynth -help the section is true and enter else loop
![pic8](https://github.com/user-attachments/assets/cd386120-755a-4434-9234-68f584e24524)
![image](https://github.com/user-attachments/assets/10d9f9da-9dd1-4d3e-be9a-4489e7e58c8d)
4. source the Unix shell to the Tcl script by passing the required csv file
  ``` bash 
 tclsh pandabro.tcl $argv[1]  
 ```

DAY 2:
2.	Convert all files to format[1] and SDC format, and pass to synthesis tool “yosys”
I.	Create the variables 
First, we need to access the .csv file using the TCL Script using the command tclsh sandysynth.tcl $argv[1]  (this $argv[1] is nothing but the path of the openMSP430_design_details.csv file or index of the .csv file) and sandysynth is nothing but the shell script it will pass the argument which is .csv file to the Tcl script sandysynth.tcl 

i.	See the file using the command
Set filename [lindex $argv 0] then the filename = openMSP430_design_details.csv (the commands in the square brackets are nothing but the Tcl commands that need to be executed)
ii.	Creates new matrix object matrix Name is ‘m’
Struct:: matrix m
iii.	To open the file with an identifier
Set f [open $filename] here f is the identifier if I want to do any process I can use $f on open file.
iv.	Conver the csv file to matrix
CSV::read2matrix $f m , auto now using this command we are processing the csv file in matric m of size(2,6) separated by comma 
v.	Close the file
Close $f closes the open csv file
vi.	Return the no of columns 
Set columns [m columns] which will return the no of columns for the matrix ‘m’ which is 2
vii.	If need to add more no of columns
m add columns $columns
viii.	Convert the matrix into  array
m link my_arr which link the above matrix m o array my_arr(col,row)
ix.	Return the no of rows
Set the no of_rows [m rows]
$1=0 and then enter the loop
x.	use while loop to access array elements, read row by row and extract first column cell contains and remove the spaces between the strings to make them used as valid variable names.
Info is the message commands used to user to know what is happening 
xi.	string map {_gosh _vsd} it will replace the _gosh with _vsd in the string string map {“ ” “”} remove the spaces from the value of the string in array.
xii.	[File normalize $my_arr(1,$i)] this will provide the actual path of the file name that is in the path directory the normalize function is used for normalizing the paths to absolute paths and not have relative paths ( ./ or ~/)and both the variable name and the value are autogenerated using strings from the column0 and column 1 of the csv file for second row onwards ( row1)
All the pics for day 2 are pic10,


II.	Check if directories and files mentioned in .csv exist or not 
i.	check if the directory paths are pointing to the directories using
![file is directory $outputDirectory] will return logic 1 if the output directory is valid else return logic 0 if the logic is 1 then it is false and will exit the if condition and enters in to else and will execute if the logic is 0 then it is true and the condition get satisfied and will print the info telling the output directory is not valid and also create a output directory using file mkdir $outputDirectory
ii.	If we need to see if the netlist directory exists or not then we can only provide if its present or not we did not create any netlist directory same for early library, late library and constraints file pic 11,12
III.	Read constraints file for above .csv and convert to SDC format
Target of this task is to convert the constraints csv file to the standard synopsis design constraints  file which is understood by the synthesis tool the csv file has various sections for the constraints like clock, Input, and output, with various parameters for it defined like early delay, late_delay, load, rise fall time Each input, output and clock constraints need to be handled differently. Some of the inputs are buses and need to put * marks that indicate the inputs are buses. The csv file of the constraints looks like below.
i.	Convert the csv file to matrix and Get count of the rows and columns pic14 pic13
ii.	We need to get row number for the inputs like clocks, inputs and outputs and need to process them separately
And I will also need to get column number for that row pic 15,pic16
DAY 3:
IV.	Read all files in netlist directory
Clock ports:
1.	The rectangle area which is highlighted we can get by using the code below and by executing the code we will get the early rise_delay is equal to 3 from the number of columns and input ports start we will get the boundaries of that rectangle box screen shot in tab
2.	We are opening the openMSp430.sdc in write mode by using the command set sdc_file [open $outputDirectory/$DesignName.sdc “w” now we will take the various values from the csv file and write it ibn to sdc constraints which has /port/ signal /variable names picked from the excel file and corresponding values of the constraints. The csv file is input and the sdc constraints are the output. Screen shot in tab pic 17,18,19
Algorithm to categorize input ports as bits and bussed
i.	In the inputs ports there are multibit and single bit ports, and the multibit ports are called bus for eg: dbg_i2c_addr and dbg_i2c_broadcast ss in tab
ii.	If there is an n bit bus, then put “*” in front of port else if it single bit then keep the port as it is. ss in tab
iii.	Related clock is the expression we follow to get that rectangular box. In that rectangular box we need to find all the keywords which are presented in each column.
iv.	 We will get the input port for eg.cpu_en &dbg_i2c_addr=>$pattern1 and will Open the each .V file and grep for $pattern1 in each file then split the string which you get in output using “;” as a delimiter and get the index[0 ] for that we need to grep the input in patterns generated by above step and then replace multiple spaces by single space in order to do that I need to count no of elements in the string and save it as $count then use the condition like if the $count is grater that 2 then put “* ” in front of the port  else keep he port as it is ss in tab
v.	Now investigate the script below pic 20 which will explain how we can get one input without any spaces eg: “input cpu_en;” and pic 21 is the output of the above code 
vi.	and after grep for replace multiple places, we go the output file as shown in pic22 
vii.	Next steps are first we need to open the tmp1 in read mode and then open the tmp2 file in write mode where we can dump the files. Then we will split the elements in tmp1 using the new line and then uniquify and sort the elements and then join the elements and will write in tmp2 file this will allow us to remove the duplicate elements. Close tmp1 and tmp2 file and again open the tmp2 file in read mode the count the length of the element if it’s greater than 2 then put “*” in front of that port the code was shown in pic23 and the output is shown in pic24, splitting pic25, sorting pic26, joining pic27 and pic 28
viii.	Finally, all these constraints will be saved in sdc file which will show the constraints in file name  $outputDirectory/$DesignName.sdc after the code is fully executed pic 29, and the file shows pic30, pic31
Constraints generation logic for the output port and conclusion!!
The script is exactly same as the input, but the only difference is we
 are replacing the input with the output pic32
V.	Create main synthesis script in format[2].
VI.	Pass the script to yosys
Yosys synthesis toolbox: take the RTL and put that in yosys synthesis toolbox will execute the output. The tool will read all the Verilog file will provide the synthesis Verilog netlist as the output 
i.	We will create a hierarchy check script to be used by yosys pic33 show the code for the hierarchy and after running the code will the output shown in pic 34 when we open the file it looks like the below image pic 35
Error handling in hierarchy check:
i.	Checking whether the top-level hierarchy is being well connected with all hierarchy which is present file if not which module is missing
ii.	If any module not found error flag is set to 1, If all modules found error flag is set to 0 pic 36
iii.	If we change the module name to omsp_clock_mocule to omsp_clock_mocule_vsd, see what the flag value is pic37 and we can see the error in log file pic38 we can remove the error in the Verilog file and will run again then the flag is 0 and we did not see any error in hierarchy log file 
iv.	We will check if the hierarchy passes or fail the code is pic 39 the output pic 40 and pic 41

DAY 5:
Main synthesis script:
i.	We are running the synthesis and seeing if the synthesis is passing or failing based on the hierarchy PIC43,42

3.	Convert format[1] and SDC to format[2] and pass to timing tool ’opentimer’
Edit Output File
I.	We will remove all the  “*” in the synth.v file  pic44
II.	Will open the new file which is final.synth.v in write mode and will open tmp file is read mode pic46 pic 47 is the final.synth.v
PROCS:
I.	It is used to create commands in EDA tools in TCL you can create procname once and will use it multiple times in the overall code 
Eg: set_multi_cpu_usage PROC  this is used for distributed operations
Pic48 is code which will provide the length of the $args and pic49 is output of procs
II.	Set_multi_cpu_usage 
Pic50,51 for output
Open .conf file to see the output pic52 after removing all the puts commands then the output is pic53
III.	Read_lib_PROC:
It will set the paths to early and late libraries of .csv file pic54 if we comment the reopenStdout then this will appear on the screen and there is no .conf file that is created pic 55 
IV.	Read_verilog_Proc
Pic56 is the output, and the code is given below and pic57 is code 
V.	Read_SDC_Proc
We will get rid of the square brackets 

VI.	.conf file creation
Master file that is supplied to opentimer tool to do STA the code to create a spec file is given in pic58 the output is pic59 the spef file looks like this pic60 and conf file is pic61
Quality of Results(QOR)generation
I.	Runtime(pic62)
II.	Report Formatting (pic63)

## Day2: Variable Creation and Processing Constraints from CSV
## Day3: Processing Clock and Input Constraints
## Day4: Completing Scripting and Yosys Synthesis Introduction
## Day5: Advanced Scripting Techniques and Quality of Results Generation

